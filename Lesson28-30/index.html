<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="index.css">
    <style>
        .describe {
            font-size: 12px;
            color: slategray;
        }
    </style>
</head>
<body>
<div class="describe">
    <p>根据下面需求实现如示意图所示的邮箱输入提示功能，注意，根据要求只需实现下面功能</p>

    <p>当用户没有任何输入时，提示框消失</p>
    <p>当用户输入字符后，显示提示框，并且把用户输入的内容自动拼上邮箱后缀进行显示</p>
    <p>暂时不用考虑示意图中的红色和蓝色背景色的逻辑</p>
    <p>注意用户输入中前后空格需要去除</p>
</div>
<div class="wrapper">
    <input id="email-input" type="text">
    <ul id="email-sug-wrapper" class="email-sug"></ul>
</div>
</body>
<script>
// 邮箱后缀List参考
var postfixList = ['163.com', 'gmail.com', '126.com', 'qq.com', '263.net'];

let emailInput = document.getElementById('email-input');
let emailSugWrapper = document.getElementById('email-sug-wrapper');

if(!emailInput.value) emailSugWrapper.style.display = 'none';

for(let i = 0;i < postfixList.length;i++) {
    let li = document.createElement('li');

    // 监听input输入框，如果有内容，显示提示框；反之隐藏提示框
    emailInput.addEventListener('input', function(e) {
        let event = e || window.event;
        let target = event.target || event.srcElement;

        // 如果输入框没有值
        if(!emailInput.value) {
            emailSugWrapper.style.display = 'none'; // 隐藏提示框
            emailSugWrapper.innerHTML = ''; // 提示框的html至为空
        }else {
            let liIndex = 0;

            // 如果键盘按键不是回车，上，下；
            if(event.code !== 'ArrowUp' || event.code !== 'ArrowDown' || event.code !== 'Enter') {
                let newEmailInputValue = sliceText(emailInput.value, '@'); // 存储 @ 之前的字符；

                let index = (emailInput.value).indexOf('@'); // 获取 @ 出现的下标；
                li.innerHTML = ''; // 提示框的 li 先至为空
                // 如果 @ 出现
                if(index !== -1) {
                    let afterValue = emailInput.value.slice(index + 1); // 存储 @ 之后的字符；
                    // 如果 @ 之后的字符有值
                    if(afterValue) {
                        /* for(let j = 0;j < afterValue.length;j++) { debugger
                         if(afterValue[j] === postfixList[i][j]) {
                         li.innerHTML = trim(newEmailInputValue) + '@' + postfixList[i];
                         }
                         }*/

                        // 如果邮箱后缀数组中有 @ 之后的字符
                        if(postfixList[i].indexOf(afterValue) !== -1) {
                            console.log(postfixList[i],'postfixList[i]');
                            li.innerHTML = trim(newEmailInputValue) + '@' + postfixList[i]; // 提示框显示输入的文字及邮箱后缀
                        }
                    }else {
                        li.innerHTML = trim(newEmailInputValue) + '@' + postfixList[i]; // 提示框显示输入的文字及邮箱后缀
                    }
                }
                else {
                    li.innerHTML = trim(newEmailInputValue) + '@' + postfixList[i]; // 提示框显示输入的文字及邮箱后缀
                }


                emailSugWrapper.appendChild(li);
                emailSugWrapper.style.display = 'block';
                li.className = 'active';
//                console.log(emailSugWrapper.getElementsByTagName('li')[0],'li');
            }else {
//                li.
            }


        }
    })
}

// 去掉两端空格
function trim(emailInputValue) {
    return emailInputValue.trim();
}

// 截取指定字符串出现前的位置
function sliceText(emailInputValue, character) {
    // 如果 emailInputValue 中存在 ；
    if(emailInputValue.indexOf(character) !== -1) {
        emailInputValue = emailInputValue.slice(0, emailInputValue.indexOf(character)); // 截取 emailInputValue 的起始位置到 character 的位置（不包括character）
    }
    return emailInputValue; // 返回截取后的 emailInputValue
}

// 监听提示框li的点击事件，事件委托
emailSugWrapper.addEventListener('click', function(e) {
    let event = e || window.event;
    let target = event.target || event.srcElement;
    if(target.tagName.toLowerCase() === 'li') {
        emailInput.value = target.innerHTML; // 把点击的 li 内容赋给输入框
        emailInput.focus(); // 焦点在输入框

        emailSugWrapper.style.display = 'none'; // 隐藏提示框
        emailSugWrapper.innerHTML = ''; // 提示框内容至为空
    }
})

window.onload = function() {
    emailInput.focus(); // 焦点在输入框
}
</script>
</html>