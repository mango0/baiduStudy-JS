<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
<div class="wrapper">
    <input id="email-input" type="text" autocomplete="off">
    <ul id="email-sug-wrapper" class="email-sug"></ul>
</div>

<script>
// 邮箱后缀List参考
const postfixList = ['163.com', 'gmail.com', '126.com', 'qq.com', '263.net'];

let emailInput = document.getElementById('email-input');
let emailSugWrapper = document.getElementById('email-sug-wrapper');

let arr = []; // 存储输入的文字拼接邮箱地址

judgeHasValue(emailInput.value);
// 当用户没有任何输入时，提示框消失
function judgeHasValue(value) {
    if(!value) {
        emailSugWrapper.style.display = 'none';
        emailSugWrapper.innerhtml = '';
        return false;
    }else {
        emailSugWrapper.style.display = 'block';
        return true;
    }
}
// 当用户输入字符后，显示提示框，并且把用户输入的内容自动拼上邮箱后缀进行显示
// 监听输入框事件

// 判断输入框的值是否含有 特殊字符，且特殊字符后面还有值；
function judugeChatacter(trimValue) {
    // 如果输入框的值包含 '@'，
    if(trimValue.indexOf('@') !== -1) {
        let index = trimValue.indexOf('@') + 1;

        // 如果 '@' 后面有值,截取 '@' 后面的值
        if(trimValue.slice(index)) {
            trimValue = trimValue.slice(index)
        }
    }
    return trimValue;
}

//
function aa(value) {
    let newArr = [];
    for(let i = 0;i < postfixList.length;i++) {
        // 如果 postfixList 的对象 中有包含后面的值的话，提出该对象
        if(postfixList[i].indexOf(value) !== -1) {
            newArr.push(postfixList[i]);
        }
    }

    // 如果有提出的对象，则返回新数组；否则返回原数组
    return newArr.length !== 0 ? newArr : postfixList;
}



    emailInput.addEventListener('input', function () {
        if(judgeHasValue(emailInput.value)) {
            let trimValue = trim(emailInput.value); // 获取输入框的值，并去掉两端空格；

            let newValue = judugeChatacter(trimValue);

            let newPostfixList = aa(newValue);
            let newValueList = [];

            for(let i = 0;i < newPostfixList.length;i++) {
                newValueList.push(sliceString(trimValue, '@') + '@' + aa(newValue)[i]);
            }

            for(let i = 0;i < newValueList.length;i++) {
                let li = document.createElement('li');
                li.innerHTML = newValueList[i];
                emailSugWrapper.appendChild(li);

            }

            newPostfixList = [];

        }


        /*let newList = judgeString(emailInput.value, '@');
        console.log(newList,'newList');

        for(let i = 0;i < newList.length;i++) {
            if (judgeHasValue(emailInput.value)) {
                li.innerHTML = sliceString(trim(emailInput.value), '@') + '@' + newList[i];
            }
        }*/
    })

//}



// 去除输入中前后空格
function trim(value) {
    if(value) {
        value = value.trim();
    }
    return value;
}

//当用户输入含有 @ 符号时，我们选取用户输入的@前面的字符来和后缀拼接
function sliceString(value, appointCharacter) {
    if(value) {
        // 如果输入的字符串中有指定字符串
        if(value.indexOf(appointCharacter) !== -1) {
            let index = value.indexOf(appointCharacter);
            value = value.slice(0, index);
        }
    }
    return value;
}

//当用户输入了 @ 及部分后缀时，只从 postfixList 选取符合用户输入预期的后缀，我们以前缀匹配为要求。
//当用户输入不满足任何前缀匹配时，则显示全部提示
function judgeString(value, appointCharacter) {
    if(value.indexOf(appointCharacter) !== -1) {
        let index = value.indexOf(appointCharacter) + 1;
        // 如果'@'后面有值的话,截取后面的值
        if(value.slice(index)) {
            value = value.slice(index);
        }
    }

    let newArr = [];
    for(let i = 0;i < postfixList.length;i++) {
        // 如果 postfixList 中有包含后面的值的话，提出来；
        if(postfixList[i].indexOf(value) !== -1) {
            newArr.push(postfixList[i]);
        }else {
            newArr.push(postfixList[i]);
        }
    }
    return newArr;
}

</script>
</body>
</html>